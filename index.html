<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1E3260">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medi Clicks - Dashboard Dinámico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/vanilla-js-calendar@1.6.1/build/vanilla-js-calendar.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <!-- Favicon Links (Asegúrate que estos archivos existan en la carpeta /images/) -->
   <link rel="icon" href="images/favicon.ico" type="image/x-icon">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="apple-touch-icon" href="images/apple-touch-icon.png">

    <script>    
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], },
                    colors: {
                        'brand-bg-main-start': '#EFF6FF', 'brand-bg-main-end': '#DBEAFE', 'brand-sidebar': '#1E3A8A',
                        'brand-sidebar-hover': '#1D4ED8', 
                        'brand-primary': '#1E3260', 
                        'brand-primary-hover': '#162649',
                        'brand-primary-active': '#0F1A33',
                        'brand-text-primary': '#1E293B', 'brand-text-secondary': '#475569',
                        'brand-text-sidebar': '#E0F2FE', 'brand-border-light': '#BFDBFE', 
                        'brand-border-focus': '#1E3260', 
                        'brand-white': '#FFFFFF', 'brand-light-bg': '#F9FAFB',
                        'success': '#10B981', 'info': '#3B82F6', 'warning': '#F59E0B', 
                        'danger': { 
                            DEFAULT: '#EF4444',
                            light: '#F87171' // Para texto en dark mode
                        },
                        primary: { 
                            light: '#5170A7', 
                            DEFAULT: '#1E3260', 
                            dark: '#162649', 
                            darker: '#0F1A33' 
                        },
                        secondary: '#EFF6FF', lightgray: '#F3F4F6'
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --color-brand-bg-main-start: #EFF6FF; --color-brand-bg-main-end: #DBEAFE; --color-brand-sidebar: #1E3A8A;
            --color-brand-sidebar-hover: #1D4ED8; 
            --color-brand-primary: #1E3260;
            --color-brand-primary-hover: #162649; 
            --color-brand-primary-active: #0F1A33; 
            --color-brand-text-primary: #1E293B; --color-brand-text-secondary: #475569;
            --color-brand-text-sidebar: #E0F2FE; --color-brand-border-light: #BFDBFE; 
            --color-brand-border-focus: #1E3260; 
            --color-brand-white: #FFFFFF; --color-brand-light-bg: #F9FAFB;
            --shadow-soft: 0px 4px 10px rgba(0,0,0,0.08); --shadow-medium: 0px 6px 15px rgba(30,58,138,0.12); --shadow-strong: 0px 8px 25px rgba(30,58,138,0.15);
            --border-radius-small: 0.375rem; --border-radius-medium: 0.5rem; --border-radius-large: 0.75rem; --border-radius-xl: 1rem;
        }
        html.dark {
            --color-brand-bg-main-start: #1F2937; 
            --color-brand-bg-main-end: #111827;   
            --color-brand-sidebar: #1E3A8A;       
            --color-brand-sidebar-hover: #1D4ED8; 
            --color-brand-primary: #5170A7;       
            --color-brand-primary-hover: #6A89C1;
            --color-brand-primary-active: #3C5A8E;
            --color-brand-text-primary: #F3F4F6;  
            --color-brand-text-secondary: #9CA3AF;
            --color-brand-text-sidebar: #E0F2FE;  
            --color-brand-border-light: #374151;  
            --color-brand-border-focus: #5170A7; 
            --color-brand-white: #111827;         
            --color-brand-light-bg: #1F2937;      

            --shadow-soft: 0px 4px 10px rgba(0,0,0,0.3);
            --shadow-medium: 0px 6px 15px rgba(0,0,0,0.35);
            --shadow-strong: 0px 8px 25px rgba(0,0,0,0.4);
        }

        html { scroll-behavior: smooth; }
        body { display: flex; min-height: 100vh; font-family: 'Inter', sans-serif; color: var(--color-brand-text-primary); background-color: var(--color-brand-bg-main-start); } 
        
        #loginScreen { display: none; }
        .content-wrapper { display: none; flex-grow: 1; width: 100%; }

        aside {
            height: 100vh;
            flex-shrink: 0;
            background-color: var(--color-brand-sidebar);
            color: var(--color-brand-text-sidebar);
            box-shadow: var(--shadow-medium);
            transition: transform 0.3s ease-in-out;
        }
        aside.fixed { z-index: 40; }
        @media (min-width: 1024px) { 
            aside { position: sticky; top: 0; transform: translateX(0) !important; }
        }

        main { flex-grow: 1; height: 100vh; overflow-y: auto; background-image: linear-gradient(145deg, var(--color-brand-bg-main-start), var(--color-brand-bg-main-end)); transition: margin-left 0.3s ease-in-out; }
        aside .border-b { border-color: rgba(255,255,255,0.1); } 
        aside .sidebar-logo-container img { display: block; margin-left: auto; margin-right: auto; } 
        aside .sidebar-logo-container p { color: var(--color-brand-text-sidebar); }

        .nav-link { color: var(--color-brand-text-sidebar); border-radius: var(--border-radius-medium); transition: background-color 0.2s ease, color 0.2s ease, transform 0.1s ease; } .nav-link:hover { background-color: var(--color-brand-sidebar-hover); color: var(--color-brand-white); transform: translateX(2px); } .nav-link.active { background-color: var(--color-brand-primary); color: var(--color-brand-white); font-weight: 600; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); } .nav-link svg { stroke: currentColor; }
        main h2.text-2xl, main h2.text-3xl { color: var(--color-brand-text-primary); font-weight: 600; } main h3 { color: var(--color-brand-text-primary); }
        .content-card-modern, .dashboard-card { background-color: var(--color-brand-white); border-radius: var(--border-radius-large); box-shadow: var(--shadow-soft); transition: transform 0.2s ease-out, box-shadow 0.2s ease-out; } .content-card-modern { padding: 1.5rem; } .dashboard-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-medium); } .dashboard-card h3 { color: var(--color-brand-text-secondary); }
        .profile-card { background-color: var(--color-brand-white); border-radius: var(--border-radius-large); box-shadow: var(--shadow-soft); padding: 1.5rem; } .profile-card h3 { font-size: 1.125rem; font-weight: 600; color: var(--color-brand-primary); margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--color-brand-border-light); } .profile-card p, .profile-card li { font-size: 0.875rem; color: var(--color-brand-text-secondary); margin-bottom: 0.375rem; } .profile-card strong { color: var(--color-brand-text-primary); } .profile-card ul { list-style: none; padding: 0; } .profile-card li { padding: 0.625rem 0; border-bottom: 1px dashed var(--color-brand-border-light); } .profile-card li:last-child { border-bottom: none; } .profile-card .sub-section { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--color-brand-light-bg); } .profile-card .sub-section h4 { font-size: 0.875rem; font-weight: 600; color: var(--color-brand-primary); margin-bottom: 0.5rem; }
        #detallePerfilClientePreview.profile-detail-card { background-color: var(--color-brand-light-bg); border-radius: var(--border-radius-medium); box-shadow: var(--shadow-soft); max-height: 70vh; overflow-y: auto; }
        .btn { transition: all 0.2s ease-in-out; border-radius: var(--border-radius-medium); } .btn:hover { transform: translateY(-1px); filter: brightness(1.05); } .btn:active { transform: translateY(0px); filter: brightness(0.95); }
        .btn-primary-modern { background-color: var(--color-brand-primary); color: var(--color-brand-white); font-weight: 500; padding: 0.625rem 1.25rem; border-radius: var(--border-radius-medium); box-shadow: var(--shadow-soft); } .btn-primary-modern:hover { background-color: var(--color-brand-primary-hover); box-shadow: var(--shadow-medium); } .btn-primary-modern:active { background-color: var(--color-brand-primary-active); } .btn-primary-modern svg { fill: currentColor; stroke: currentColor; }
        .btn-secondary-modern { background-color: var(--color-brand-light-bg); color: var(--color-brand-primary); font-weight: 500; padding: 0.625rem 1.25rem; border-radius: var(--border-radius-medium); border: 1px solid var(--color-brand-border-light); box-shadow: var(--shadow-soft); } .btn-secondary-modern:hover { background-color: var(--color-brand-border-light); border-color: var(--color-brand-border-focus); color: var(--color-brand-primary-hover); } .btn-secondary-modern svg { stroke: currentColor; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="number"], input[type="date"], input[type="time"], input[type="password"], textarea, select { border-radius: var(--border-radius-medium) !important; border: 1px solid var(--color-brand-border-light) !important; padding: 0.625rem 0.875rem !important; color: var(--color-brand-text-primary) !important; background-color: var(--color-brand-white) !important; box-shadow: 0 1px 2px rgba(0,0,0,0.03) !important; transition: border-color 0.2s ease, box-shadow 0.2s ease; } 
        input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus, input[type="number"]:focus, input[type="date"]:focus, input[type="time"]:focus, input[type="password"]:focus, textarea:focus, select:focus { border-color: var(--color-brand-border-focus) !important; box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-brand-primary) 20%, transparent) !important; outline: none !important; } 
        label { color: var(--color-brand-text-secondary); font-weight: 500; }
        
        html.dark input[type="text"], html.dark input[type="email"], html.dark input[type="tel"], 
        html.dark input[type="number"], html.dark input[type="date"], html.dark input[type="time"], 
        html.dark input[type="password"], html.dark textarea, html.dark select {
            background-color: var(--color-brand-light-bg) !important; 
            border-color: var(--color-brand-border-light) !important;
            color: var(--color-brand-text-primary) !important;
        }
        html.dark input:focus, html.dark textarea:focus, html.dark select:focus,
        html.dark input[type="password"]:focus {
             border-color: var(--color-brand-border-focus) !important; 
             box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-brand-primary) 40%, transparent) !important;
        }
        html.dark label { color: var(--color-brand-text-secondary); }


        .modal { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; z-index: 50; } .modal.active { display: flex; opacity: 1; } .modal-content { background-color: var(--color-brand-white); border-radius: var(--border-radius-xl); box-shadow: var(--shadow-strong); border: none; transition: transform 0.3s ease-in-out; transform: translateY(-20px); } .modal.active .modal-content { transform: translateY(0); } .modal-content h3.text-2xl { color: var(--color-brand-primary); } .modal-content .service-group { border-top: 1px solid var(--color-brand-border-light); margin-top: 1.5rem; padding-top: 1.5rem; } .modal-content .service-group h4 { color: var(--color-brand-primary); font-weight: 600; }
        .table-container-modern { background-color: var(--color-brand-white); border-radius: var(--border-radius-large); box-shadow: var(--shadow-soft); overflow: hidden; } .table-container-modern table thead { background-color: var(--color-brand-light-bg); } .table-container-modern table th { color: var(--color-brand-text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid var(--color-brand-border-light); padding: 0.75rem 1.5rem; } .table-container-modern table td { color: var(--color-brand-text-primary); border-bottom: 1px solid var(--color-brand-light-bg); padding: 0.75rem 1.5rem; } .table-container-modern table tr:last-child td { border-bottom: none; } .table-container-modern table tr:hover td { background-color: var(--color-brand-bg-main-start); }
        
        html.dark .table-container-modern { background-color: var(--color-brand-light-bg); }
        html.dark .table-container-modern table thead { background-color: var(--color-brand-bg-main-end); }
        html.dark .table-container-modern table th { color: var(--color-brand-text-secondary); border-bottom-color: var(--color-brand-border-light); }
        html.dark .table-container-modern table td { color: var(--color-brand-text-primary); border-bottom-color: var(--color-brand-border-light); }
        html.dark .table-container-modern table tr:hover td { background-color: var(--color-brand-bg-main-end); }


        .table-container-modern .ver-perfil-btn, .table-container-modern .editar-cliente-btn, .table-container-modern .editar-tarea-btn, .table-container-modern .editar-publicacion-btn { color: var(--color-brand-primary); } 
        .table-container-modern .ver-perfil-btn:hover, .table-container-modern .editar-cliente-btn:hover, .table-container-modern .editar-tarea-btn:hover, .table-container-modern .editar-publicacion-btn:hover { color: var(--color-brand-primary-hover); text-decoration: underline; } 
        
        .table-container-modern .eliminar-cliente-btn, .table-container-modern .eliminar-tarea-btn, .table-container-modern .eliminar-publicacion-btn, .table-container-modern .eliminar-ingreso-btn, .table-container-modern .eliminar-cuentacobrar-btn, .table-container-modern .eliminar-cuentaempresa-btn,
        .btn.eliminar-paquete-btn { 
            color: var(--tw-colors-danger-DEFAULT, #EF4444); /* tw-colors-danger-DEFAULT es hypothetical, usando color directo */
        } 
        .table-container-modern .eliminar-cliente-btn:hover, .table-container-modern .eliminar-tarea-btn:hover, .table-container-modern .eliminar-publicacion-btn:hover, .table-container-modern .eliminar-ingreso-btn:hover, .table-container-modern .eliminar-cuentacobrar-btn:hover, .table-container-modern .eliminar-cuentaempresa-btn:hover,
        .btn.eliminar-paquete-btn:hover { 
            color: #B91C1C; /* Tailwind red-700 */
            text-decoration: underline; 
        }

        html.dark .table-container-modern .ver-perfil-btn, 
        html.dark .table-container-modern .editar-cliente-btn, 
        html.dark .table-container-modern .editar-tarea-btn, 
        html.dark .table-container-modern .editar-publicacion-btn { 
            color: var(--color-brand-primary); /* Ya es claro en dark mode */
        }
        html.dark .table-container-modern .ver-perfil-btn:hover, 
        html.dark .table-container-modern .editar-cliente-btn:hover, 
        html.dark .table-container-modern .editar-tarea-btn:hover, 
        html.dark .table-container-modern .editar-publicacion-btn:hover { 
            color: var(--color-brand-primary-hover); 
        }

        html.dark .table-container-modern .eliminar-cliente-btn, 
        html.dark .table-container-modern .eliminar-tarea-btn, 
        html.dark .table-container-modern .eliminar-publicacion-btn, 
        html.dark .table-container-modern .eliminar-ingreso-btn, 
        html.dark .table-container-modern .eliminar-cuentacobrar-btn, 
        html.dark .table-container-modern .eliminar-cuentaempresa-btn,
        html.dark .btn.eliminar-paquete-btn {
            color: #F87171; /* Tailwind red-400 (danger.light) */
        }
        html.dark .table-container-modern .eliminar-cliente-btn:hover, 
        html.dark .table-container-modern .eliminar-tarea-btn:hover, 
        html.dark .table-container-modern .eliminar-publicacion-btn:hover, 
        html.dark .table-container-modern .eliminar-ingreso-btn:hover, 
        html.dark .table-container-modern .eliminar-cuentacobrar-btn:hover, 
        html.dark .table-container-modern .eliminar-cuentaempresa-btn:hover,
        html.dark .btn.eliminar-paquete-btn:hover {
            color: #FCA5A5; /* Tailwind red-300 */
        }


        .page-section.hidden { display: none !important; }
        #loadingOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: color-mix(in srgb, var(--color-brand-sidebar) 80%, black); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10000; color: white; font-size: 1.2em; } .spinner, .spinner-inline { border: .2em solid currentColor; border-right-color: transparent; border-radius: 50%; animation: spinner-border .75s linear infinite; } .spinner { width: 40px; height: 40px; margin-bottom: 10px; } .spinner-inline { display: inline-block; width: 1em; height: 1em; vertical-align: -0.125em; margin-right: 0.5rem;} @keyframes spinner-border { to { transform: rotate(360deg); } }
        p { line-height: 1.6; }
        ::-webkit-scrollbar { width: 10px; height: 10px; } ::-webkit-scrollbar-track { background: var(--color-brand-bg-main-start); border-radius: 10px;} ::-webkit-scrollbar-thumb { background: var(--color-brand-border-focus); border-radius: 10px; border: 2px solid var(--color-brand-bg-main-start); } ::-webkit-scrollbar-thumb:hover { background: var(--color-brand-primary); }
        .vanilla-calendar { box-shadow: var(--shadow-soft); border: 1px solid var(--color-brand-border-light); border-radius: var(--border-radius-large); margin-bottom: 1.5rem; background-color: var(--color-brand-white); } .vanilla-calendar .vanilla-calendar-header { background-color: var(--color-brand-light-bg); padding-bottom: 0.5rem; border-bottom: 1px solid var(--color-brand-border-light); } .vanilla-calendar .vanilla-calendar-header *, .vanilla-calendar .vanilla-calendar-week__day { color: var(--color-brand-text-primary); } .vanilla-calendar .vanilla-calendar-week__day { font-weight: 600; } .vanilla-calendar .vanilla-calendar-day__btn_today:not(.vanilla-calendar-day__btn_selected) { background-color: color-mix(in srgb, var(--color-brand-primary) 20%, transparent) !important; color: var(--color-brand-primary) !important; border-radius: 50%; } .vanilla-calendar .vanilla-calendar-day__btn_selected { background-color: var(--color-brand-primary) !important; color: var(--color-brand-white) !important; border-radius: 50%; box-shadow: 0 0 0 2px var(--color-brand-white), 0 0 0 4px var(--color-brand-primary); } .vanilla-calendar .vanilla-calendar-day__btn:hover:not(.vanilla-calendar-day__btn_selected):not(.vanilla-calendar-day__btn_disabled) { background-color: var(--color-brand-border-light) !important; border-radius: 50%; } .vanilla-calendar .vanilla-calendar-day__marker { background-color: var(--color-brand-primary); width: 6px; height: 6px; border-radius: 50%; margin-top: 3px; display: block; }
        html.dark .vanilla-calendar .vanilla-calendar-day__btn_selected { color: #111827 !important; }
        html.dark .vanilla-calendar .vanilla-calendar-day__btn_today:not(.vanilla-calendar-day__btn_selected) { background-color: color-mix(in srgb, var(--color-brand-primary) 40%, transparent) !important; }

        /* Estilos para el botón de eliminar paquete */
        .btn.eliminar-paquete-btn {
            /* Clases de Tailwind para el botón eliminar paquete, ya se manejan con dark: en el HTML si es necesario */
        }
    </style>
</head>
<body class="font-sans">

<div id="loginScreen" class="fixed inset-0 bg-brand-sidebar flex items-center justify-center z-[10001]">
    <div class="bg-brand-white dark:bg-slate-800 p-8 rounded-xl shadow-xl w-full max-w-sm text-center">
        <img src="images/logo-color.png" alt="Medi Clicks Logo" class="h-auto w-3/4 max-w-[200px] mx-auto mb-6">
        <h2 class="text-2xl font-semibold text-brand-primary dark:text-primary-light mb-6">Iniciar Sesión</h2>
        <form id="loginForm">
            <div class="mb-4">
                <label for="username" class="block text-sm font-medium text-brand-text-secondary dark:text-slate-400 text-left mb-1">Usuario</label>
                <input type="text" id="username" name="username" required class="w-full">
            </div>
            <div class="mb-6">
                <label for="password" class="block text-sm font-medium text-brand-text-secondary dark:text-slate-400 text-left mb-1">Contraseña</label>
                <input type="password" id="password" name="password" required class="w-full">
            </div>
            <button type="submit" class="w-full btn btn-primary-modern">Ingresar</button>
        </form>
        <p id="loginError" class="text-danger text-sm mt-4 hidden"></p>
    </div>
</div>

<div id="loadingOverlay" style="display: none;">
    <img src="images/logo-completo-blanco.png" alt="Cargando Medi Clicks" class="h-auto w-1/2 max-w-[200px] mb-4">
    <div class="spinner"></div>
    <span id="loadingMessage">Cargando datos iniciales...</span>
</div>

    <button id="sidebar-toggle" class="lg:hidden fixed top-4 left-4 z-[60] p-2 bg-brand-primary text-white rounded-md shadow-lg" style="display: none;">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>

    <div class="content-wrapper">
        <aside class="w-64 flex flex-col transform -translate-x-full lg:translate-x-0 fixed lg:sticky top-0 h-screen">
            <div class="p-4 border-b flex flex-col items-center sidebar-logo-container">
                <img src="images/logo-completo-blanco.png" alt="Medi Clicks Logo" class="h-auto w-3/4 max-w-[180px] mb-3">
                <p class="text-sm text-center opacity-80">Panel de Gestión</p>
            </div>
            <nav class="flex-grow p-4 space-y-2">
                <a href="#dashboard" class="nav-link flex items-center px-4 py-2 btn">
                    <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    Dashboard
                </a>
                <a href="#clientes" class="nav-link flex items-center px-4 py-2 btn">
                    <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    Clientes
                </a>
                <a href="#tareas" class="nav-link flex items-center px-4 py-2 btn">
                    <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    Tareas
                </a>
                <a href="#publicaciones" class="nav-link flex items-center px-4 py-2 btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Publicaciones
                </a>
                <a href="#paquetes-servicios" class="nav-link flex items-center px-4 py-2 btn">
                    <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    Paquetes Servicios
                </a>
                <a href="#servicios-web" class="nav-link flex items-center px-4 py-2 btn">
                    <svg class="w-5 h-5 mr-3" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path></svg>
                    Servicios Web
                </a>
                <a href="#administracion" class="nav-link flex items-center px-4 py-2 btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                    </svg>
                    Administración
                </a>
            </nav>
            <div class="p-4 mt-auto border-t border-[rgba(255,255,255,0.1)]">
                <button id="theme-toggle" class="w-full flex items-center justify-center px-4 py-2 text-sm nav-link mb-2">
                    <svg id="theme-toggle-dark-icon" class="w-5 h-5 mr-2 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    <svg id="theme-toggle-light-icon" class="w-5 h-5 mr-2 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 10.607a1 1 0 011.414-1.414l-.707-.707a1 1 0 01-1.414 1.414l.707.707zm1.414-3.536a1 1 0 00-1.414 1.414l.707.707a1 1 0 001.414-1.414l-.707-.707zM3 11a1 1 0 100 2h1a1 1 0 100-2H3z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                    <span id="theme-toggle-text"></span>
                </button>
                 <button id="btnLogout" class="w-full flex items-center justify-center px-4 py-2 text-sm nav-link bg-red-500/20 hover:bg-red-600/30 text-red-100 dark:bg-red-700/30 dark:hover:bg-red-600/40 dark:text-red-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Cerrar Sesión
                </button>
            </div>
        </aside>

        <main class="flex-grow p-6 md:p-8 lg:ml-64"> 
            <!-- El contenido de las secciones se pega aquí -->
            <section id="dashboard" class="page-section mb-8">
                <h2 class="text-2xl font-semibold mb-6">Dashboard General</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="dashboard-card p-6 border-l-4 border-success">
                        <h3 class="text-lg font-semibold mb-2">Clientes Activos</h3>
                        <p id="totalClientesActivos" class="text-4xl font-bold text-success">0</p>
                        <p class="text-sm text-brand-text-secondary mt-1">Total clientes registrados.</p>
                    </div>
                    <div class="dashboard-card p-6 border-l-4 border-danger">
                        <h3 class="text-lg font-semibold mb-2">Tareas Pendientes</h3>
                        <p id="totalTareasPendientes" class="text-4xl font-bold text-danger">0</p>
                        <p class="text-sm text-brand-text-secondary mt-1">Tareas por completar.</p>
                    </div>
                    <div class="dashboard-card p-6 border-l-4 border-warning">
                        <h3 class="text-lg font-semibold mb-2">Servicios por Vencer</h3>
                        <p id="totalClientesRevisar" class="text-4xl font-bold text-warning">0</p>
                        <p class="text-sm text-brand-text-secondary mt-1">Vencen en próximos 30 días.</p>
                    </div>
                    <div class="dashboard-card p-6 border-l-4 border-info">
                        <h3 class="text-lg font-semibold mb-2">Servicios Web</h3>
                        <p id="totalServiciosWeb" class="text-4xl font-bold text-info">0</p>
                        <p class="text-sm text-brand-text-secondary mt-1">Total dominios/proyectos.</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6">
                        <div class="content-card-modern h-fit">
                            <h3 class="text-xl font-semibold mb-4">Perfiles de Clientes (Acceso Rápido)</h3>
                            <div id="listaPerfilesClientes" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                            </div>
                            <div id="detallePerfilClientePreview" class="profile-detail-card p-6 hidden">
                            </div>
                        </div>

                        <div class="content-card-modern">
                            <h3 class="text-xl font-semibold mb-4 text-danger">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Tareas Urgentes
                            </h3>
                            <ul id="listaTareasUrgentesDashboard" class="space-y-2">
                                <li class="text-brand-text-secondary italic">No hay tareas urgentes.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="lg:col-span-1 space-y-6">
                        <div class="content-card-modern p-4 dashboard-calendar-card">
                            <h3 class="text-xl font-semibold text-center mb-4">Calendario de Tareas</h3>
                            <div id="calendar-container" class="mb-4"></div>
                            <button id="btnVerCalendarioCompleto" class="w-full btn btn-secondary-modern">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 -mb-px" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                </svg>
                                Ver Calendario Completo
                            </button>
                            <div class="mt-4 pt-4 border-t border-brand-border-light dark:border-slate-700">
                                <h4 class="text-sm font-semibold text-brand-text-primary mb-2">Próximas Entregas:</h4>
                                <ul id="listaProximasTareasDashboard" class="space-y-1 text-xs">
                                    <li class="text-brand-text-secondary italic">No hay tareas próximas.</li>
                                </ul>
                            </div>
                        </div>

                        <div class="content-card-modern">
                             <h3 class="text-xl font-semibold mb-4 text-warning">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                                Servicios Web por Vencer
                            </h3>
                            <p class="text-sm text-brand-text-secondary mb-3">Clientes con servicios web (dominio/mantenimiento) venciendo en los próximos 30 días.</p>
                            <ul id="listaServiciosPorVencerDashboard" class="space-y-2">
                                <li class="text-brand-text-secondary italic">No hay servicios web próximos a vencer.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section id="clientes" class="page-section mb-8 hidden">
                <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-semibold">Gestión General de Clientes</h2>
                    <div class="flex flex-wrap space-x-0 sm:space-x-3 gap-3 sm:gap-0">
                        <button id="btnAbrirModalCliente" class="btn btn-primary-modern flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                            Añadir Cliente
                        </button>
                        <button id="btnExportarCSVClientes" class="btn btn-secondary-modern flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            Exportar Clientes (CSV)
                        </button>
                    </div>
                </div>
                <div class="mb-6">
                    <input type="text" id="buscadorClientes" placeholder="Buscar cliente por nombre..." class="mt-1 block w-full md:w-1/2 lg:w-1/3">
                </div>
                <div class="table-container-modern overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Clínica</th>
                                <th>Servicios Principales</th>
                                <th>Pagado ($)</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaClientesBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="perfil-cliente-dedicado" class="page-section mb-8 hidden">
                 <div class="flex justify-between items-center mb-6">
                       <h2 class="text-3xl font-bold" id="nombrePerfilDedicado">Perfil del Cliente</h2>
                       <div>
                           <button id="btnVolverDesdePerfil" class="btn btn-secondary-modern mr-2">Volver</button>
                           <button id="btnEditarDesdePerfil" class="btn btn-primary-modern">Editar Cliente</button>
                       </div>
                 </div>
                 <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                       <div class="lg:col-span-1 space-y-6">
                           <div class="profile-card">
                               <h3>Información General</h3>
                               <p><strong>Clínica:</strong> <span id="perfilDedicadoClinica">-</span></p>
                               <p><strong>Email:</strong> <span id="perfilDedicadoEmail">-</span></p>
                               <p><strong>Teléfono:</strong> <span id="perfilDedicadoTelefono">-</span></p>
                               <p><strong>Total Pagado:</strong> <span id="perfilDedicadoPagado">-</span></p>
                           </div>
                           <div class="profile-card">
                               <h3>Notas Generales</h3>
                               <p id="perfilDedicadoNotas" class="whitespace-pre-wrap">-</p>
                           </div>
                       </div>
                       <div class="lg:col-span-1 space-y-6">
                           <div class="profile-card">
                               <h3>Paquetes Contratados</h3>
                               <ul id="perfilDedicadoServiciosContratados">
                                   <li>No hay paquetes contratados.</li>
                               </ul>
                           </div>
                            <div class="profile-card">
                               <h3>Servicio Web</h3>
                               <p><strong>Dominio:</strong> <span id="perfilDedicadoDominioWeb">-</span></p>
                               <p><strong>Tipo:</strong> <span id="perfilDedicadoTipoWeb">-</span></p>
                               <p><strong>Vencimiento:</strong> <span id="perfilDedicadoVencimientoWeb">-</span></p>
                           </div>
                       </div>
                       <div class="lg:col-span-1 space-y-6">
                            <div class="profile-card">
                               <h3>Configuración Redes Sociales (General)</h3>
                               <div id="perfilDedicadoConfigRedes">
                                   <p class="text-xs text-brand-text-secondary dark:text-slate-400">No hay configuración específica.</p>
                               </div>
                               <!-- Aquí podrías mostrar un resumen de las redes para las que hay credenciales (solo nombres) -->
                               <div id="perfilDedicadoCredencialesResumen" class="mt-3 pt-3 border-t border-brand-border-light dark:border-slate-700">
                                   <h4 class="text-sm font-semibold text-brand-primary dark:text-primary-light mb-1">Credenciales Guardadas para:</h4>
                                   <ul class="list-disc list-inside text-xs text-brand-text-secondary dark:text-slate-400">
                                       <!-- Se llenará con JS -->
                                   </ul>
                               </div>
                           </div>
                           <div class="profile-card">
                               <h3>Tareas Asociadas</h3>
                               <ul id="perfilDedicadoTareas">
                                   <li>No hay tareas asociadas.</li>
                               </ul>
                           </div>
                       </div>
                 </div>
            </section>

            <section id="tareas" class="page-section mb-8 hidden">
                <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-semibold">Gestión de Tareas</h2>
                    <button id="btnAbrirModalTarea" class="btn btn-primary-modern flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        Añadir Tarea
                    </button>
                </div>
                <div class="table-container-modern overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Tarea</th>
                                <th>Cliente Asociado</th>
                                <th>Fecha Entrega</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaTareasBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="publicaciones" class="page-section mb-8 hidden">
                <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-semibold">Gestión de Publicaciones</h2>
                    <button id="btnAbrirModalPublicacion" class="btn btn-primary-modern flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        Añadir Publicación
                    </button>
                </div>
                <div class="mb-6 flex flex-wrap gap-4">
                    <div>
                        <label for="filtroPublicacionesCliente" class="block text-sm font-medium mb-1">Filtrar por Cliente:</label>
                        <select id="filtroPublicacionesCliente" class="mt-1 block w-full md:w-auto">
                            <option value="">Todos los Clientes</option>
                        </select>
                    </div>
                    <div>
                        <label for="filtroPublicacionesEstado" class="block text-sm font-medium mb-1">Filtrar por Estado:</label>
                        <select id="filtroPublicacionesEstado" class="mt-1 block w-full md:w-auto">
                            <option value="">Todos los Estados</option>
                            <option value="Borrador">Borrador</option>
                            <option value="Programada">Programada</option>
                            <option value="Revisión Cliente">Revisión Cliente</option>
                            <option value="Aprobada">Aprobada</option>
                            <option value="Publicada">Publicada</option>
                            <option value="Rechazada">Rechazada</option>
                        </select>
                    </div>
                </div>

                <div class="table-container-modern overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Red Social</th>
                                <th>Contenido (Extracto)</th>
                                <th>Fecha Pub.</th>
                                <th>Hora</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaPublicacionesBody">
                        </tbody>
                    </table>
                </div>
                <div id="paginacionPublicacionesContainer" class="mt-6 flex justify-between items-center" style="display: none;">
                    <button id="btnPrevPublicaciones" class="btn btn-secondary-modern btn-sm" disabled>&laquo; Anterior</button>
                    <div id="numerosPaginaPublicaciones" class="text-sm text-brand-text-secondary">
                    </div>
                    <button id="btnNextPublicaciones" class="btn btn-secondary-modern btn-sm" disabled>Siguiente &raquo;</button>
                </div>
            </section>

            <section id="paquetes-servicios" class="page-section mb-8 hidden">
                <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-semibold">Gestión de Paquetes de Servicios</h2>
                    <button id="btnAbrirModalPaqueteServicio" class="btn btn-primary-modern flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        Añadir Paquete
                    </button>
                </div>
                <div id="listaPaquetesServicios" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            </section>

            <section id="servicios-web" class="page-section mb-8 hidden">
                <h2 class="text-2xl font-semibold mb-4">Clientes con Servicios Web</h2>
                <div class="table-container-modern overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Dominio</th>
                                <th>Tipo Servicio</th>
                                <th>Vencimiento Mant./Dominio</th>
                            </tr>
                        </thead>
                        <tbody id="tablaServiciosWebBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="administracion" class="page-section mb-8 hidden">
                <h2 class="text-3xl font-bold mb-8">Administración General</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="content-card-modern md:col-span-2">
                        <div class="flex flex-wrap justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-brand-primary dark:text-primary-light">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                                Pagos e Ingresos
                            </h3>
                            <button id="btnAbrirModalIngreso" class="btn btn-primary-modern btn-sm flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                Registrar Ingreso
                            </button>
                        </div>
                        <p class="text-brand-text-secondary dark:text-slate-400 mb-4">Registro y seguimiento de todos los ingresos de la empresa.</p>
                        <div class="mb-4 flex flex-wrap gap-4">
                            <div><label for="filtroIngresosCliente" class="block text-xs font-medium mb-1">Cliente:</label><select id="filtroIngresosCliente" class="mt-1 block w-full md:w-auto text-sm"><option value="">Todos</option></select></div>
                            <div><label for="filtroIngresosMes" class="block text-xs font-medium mb-1">Mes:</label><input type="month" id="filtroIngresosMes" class="mt-1 block w-full md:w-auto text-sm"></div>
                        </div>
                        <div class="table-container-modern overflow-x-auto max-h-96">
                            <table class="min-w-full">
                                <thead><tr><th>Fecha Pago</th><th>Cliente</th><th>Concepto</th><th>Monto</th><th>Método</th><th>Acciones</th></tr></thead>
                                <tbody id="tablaIngresosBody"></tbody>
                            </table>
                        </div>
                        <div class="mt-4 text-right"><p class="text-lg font-semibold">Total Visualizado: <span id="totalIngresosVisualizados" class="text-success dark:text-green-400">$0.00</span></p></div>
                    </div>
                    <div class="content-card-modern md:col-span-2">
                        <div class="flex flex-wrap justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-brand-primary dark:text-primary-light">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                </svg>
                                Cuentas por Cobrar
                            </h3>
                            <button id="btnAbrirModalCuentaCobrar" class="btn btn-primary-modern btn-sm flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                Añadir Cuenta
                            </button>
                        </div>
                        <p class="text-brand-text-secondary dark:text-slate-400 mb-4">Gestión de facturas pendientes y seguimiento de cobros a clientes.</p>
                         <div class="mb-4 flex flex-wrap gap-4">
                            <div><label for="filtroCuentasCobrarCliente" class="block text-xs font-medium mb-1">Cliente:</label><select id="filtroCuentasCobrarCliente" class="mt-1 block w-full md:w-auto text-sm"><option value="">Todos</option></select></div>
                            <div><label for="filtroCuentasCobrarEstado" class="block text-xs font-medium mb-1">Estado:</label><select id="filtroCuentasCobrarEstado" class="mt-1 block w-full md:w-auto text-sm"><option value="">Todos</option><option value="Pendiente">Pendiente</option><option value="Pagada Parcialmente">Pagada Parcialmente</option><option value="Pagada">Pagada</option><option value="Vencida">Vencida</option><option value="Cancelada">Cancelada</option></select></div>
                        </div>
                        <div class="table-container-modern overflow-x-auto max-h-96">
                             <table class="min-w-full">
                                <thead><tr><th>Cliente</th><th>Concepto</th><th>Monto Total</th><th>Monto Pagado</th><th>Saldo</th><th>F. Emisión</th><th>F. Vencim.</th><th>Estado</th><th>Acciones</th></tr></thead>
                                <tbody id="tablaCuentasCobrarBody"></tbody>
                            </table>
                        </div>
                        <div class="mt-4 text-right"><p class="text-lg font-semibold">Saldo Pendiente Visualizado: <span id="totalSaldoPendienteVisualizado" class="text-danger dark:text-danger-light">$0.00</span></p></div>
                    </div>
                    <div class="content-card-modern md:col-span-2">
                        <div class="flex flex-wrap justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-brand-primary dark:text-primary-light">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11V9c0-1.044.204-2.035.568-2.951M16 11c0 3.517.99 6.799 2.752 9.571m3.44-2.04l-.054-.09A13.916 13.916 0 0116 11V9c0-1.044-.204-2.035-.568-2.951" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                                </svg>
                                Cuentas de la Empresa
                            </h3>
                             <button id="btnAbrirModalCuentaEmpresa" class="btn btn-primary-modern btn-sm flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                Añadir Cuenta
                            </button>
                        </div>
                        <p class="text-brand-text-secondary dark:text-slate-400 mb-1">Información bancaria, plataformas de pago y otros datos financieros.</p>
                        <p class="text-xs text-danger dark:text-danger-light mb-4"><strong>Advertencia:</strong> Esta información es sensible. Asegura la privacidad de tu Hoja de Cálculo.</p>
                        <div class="table-container-modern overflow-x-auto max-h-72">
                             <table class="min-w-full">
                                <thead><tr><th>Entidad</th><th>Tipo</th><th>Identificador</th><th>Titular</th><th>Moneda</th><th>Acciones</th></tr></thead>
                                <tbody id="tablaCuentasEmpresaBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="content-card-modern"> 
                        <h3 class="text-xl font-semibold text-brand-primary dark:text-primary-light mb-4">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline-block mr-2 -mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Facturación Electrónica
                        </h3>
                        <p class="text-brand-text-secondary dark:text-slate-400">Integración con sistema de facturación electrónica (futura implementación).</p>
                         <div class="mt-4">
                            <button class="btn btn-primary-modern opacity-50 cursor-not-allowed">Integrar Facturación (Próximamente)</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modales -->
    <div id="modalCliente" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 dark:bg-opacity-80 dark:bg-black overflow-y-auto h-full w-full items-center justify-center z-50 p-4">
        <!-- FORMULARIO DE CLIENTE MODIFICADO -->
        <div class="modal-content w-full max-w-3xl mx-auto max-h-[95vh] overflow-y-auto p-6 md:p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 id="modalClienteTitle" class="text-2xl font-semibold">Añadir Nuevo Cliente</h3>
                <button id="btnCerrarModalCliente" class="text-brand-text-secondary hover:text-brand-primary text-4xl leading-none btn">&times;</button>
            </div>
            <form id="formCliente" class="space-y-6"> 

                <div>
                    <h4 class="text-lg font-semibold mb-3 text-brand-primary dark:text-primary-light border-b border-brand-border-light dark:border-slate-700 pb-2">Información General</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        <div>
                            <label for="nombreCliente" class="block text-sm font-medium mb-1">Nombre Completo<span class="text-danger">*</span></label>
                            <input type="text" id="nombreCliente" required class="w-full">
                        </div>
                        <div>
                            <label for="clinicaCliente" class="block text-sm font-medium mb-1">Clínica/Consultorio</label>
                            <input type="text" id="clinicaCliente" class="w-full">
                        </div>
                        <div>
                            <label for="emailCliente" class="block text-sm font-medium mb-1">Email</label>
                            <input type="email" id="emailCliente" class="w-full">
                        </div>
                        <div>
                            <label for="telefonoCliente" class="block text-sm font-medium mb-1">Teléfono</label>
                            <input type="tel" id="telefonoCliente" class="w-full">
                        </div>
                        <div class="md:col-span-2">
                            <label for="serviciosActivosGeneralCliente" class="block text-sm font-medium mb-1">Servicios Activos (Resumen)</label>
                            <input type="text" id="serviciosActivosGeneralCliente" placeholder="Ej: Web, Redes, SEO" class="w-full">
                        </div>
                        <div class="md:col-span-2">
                            <label for="notasCliente" class="block text-sm font-medium mb-1">Registro/Detalles Generales</label>
                            <textarea id="notasCliente" rows="3" class="w-full"></textarea>
                        </div>
                         <div> 
                            <label for="pagadoCliente" class="block text-sm font-medium mb-1">Total Pagado ($)</label>
                            <input type="number" id="pagadoCliente" step="0.01" value="0" class="w-full">
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold mb-3 mt-4 text-brand-primary dark:text-primary-light border-b border-brand-border-light dark:border-slate-700 pb-2">Detalles Servicio Web</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        <div>
                            <label for="dominioWebCliente">Dominio Web</label>
                            <input type="text" id="dominioWebCliente" placeholder="ej: cliente.com" class="w-full">
                        </div>
                        <div>
                            <label for="tipoServicioWebCliente">Tipo Servicio Web</label>
                            <input type="text" id="tipoServicioWebCliente" placeholder="Ej: Desarrollo, Mantenimiento" class="w-full">
                        </div>
                        <div class="md:col-span-2">
                            <label for="vencimientoWebCliente">Vencimiento Mant./Dominio</label>
                            <input type="date" id="vencimientoWebCliente" class="w-full">
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold mb-3 mt-4 text-brand-primary dark:text-primary-light border-b border-brand-border-light dark:border-slate-700 pb-2">Configuración General Redes Sociales</h4>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                        <div class="md:col-span-2">
                            <label for="plataformasRedesCliente">Plataformas (separadas por coma)</label>
                            <input type="text" id="plataformasRedesCliente" placeholder="Ej: Instagram, Facebook, X" class="w-full">
                        </div>
                        <div class="md:col-span-2">
                            <label for="detallesRedesCliente">Estrategia/Detalles Generales Redes</label>
                            <textarea id="detallesRedesCliente" rows="3" class="w-full"></textarea>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold mb-3 mt-4 text-brand-primary dark:text-primary-light border-b border-brand-border-light dark:border-slate-700 pb-2">Credenciales Redes Sociales (Sensible)</h4>
                    <div id="credencialesRedesContainer" class="space-y-4">
                        <div class="text-sm text-brand-text-secondary dark:text-slate-400 italic p-3 bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-400 dark:border-yellow-600 rounded-md">
                            <p><strong>Advertencia:</strong> Esta información es sensible. Asegúrate de que el acceso a tu Google Sheet esté bien protegido.</p>
                        </div>
                    </div>
                    <div class="mt-3 flex flex-col sm:flex-row items-stretch sm:items-center gap-x-2 gap-y-2">
                        <input type="text" id="nuevaRedSocialNombre" placeholder="Nombre Red (Ej: Instagram)" class="flex-grow input-sm">
                        <input type="text" id="nuevaRedSocialUsuario" placeholder="Usuario/Email" class="flex-grow input-sm">
                        <input type="password" id="nuevaRedSocialPassword" placeholder="Contraseña" class="flex-grow input-sm">
                        <button type="button" id="btnAddCredencialRed" class="btn btn-secondary-modern btn-sm whitespace-nowrap">Añadir Credencial</button>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold mb-3 mt-4 text-brand-primary dark:text-primary-light border-b border-brand-border-light dark:border-slate-700 pb-2">Paquetes de Servicios Contratados</h4>
                    <div id="serviciosContratadosContainer" class="space-y-4 mb-4">
                    </div>
                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-x-4 gap-y-3 p-3 bg-brand-light-bg dark:bg-slate-700/50 rounded-lg">
                        <select id="selectPaqueteServicio" class="block w-full sm:w-auto flex-grow mb-2 sm:mb-0">
                            <option value="">Seleccionar paquete...</option>
                        </select>
                        <input type="number" id="montoPaqueteServicio" placeholder="Monto" step="0.01" class="block w-full sm:w-1/4">
                        <select id="tipoCobroPaqueteServicio" class="block w-full sm:w-1/4">
                            <option value="mensual">Mensual</option>
                            <option value="anual">Anual</option>
                            <option value="unico">Pago Único</option>
                        </select>
                        <button type="button" id="btnAddServicioContratado" class="btn btn-secondary-modern btn-sm whitespace-nowrap w-full sm:w-auto">Añadir Paquete</button>
                    </div>
                </div>
                
                <div class="mt-8 flex justify-end space-x-3">
                    <button type="button" id="btnCancelarModalCliente" class="btn btn-secondary-modern">Cancelar</button>
                    <button type="submit" class="btn btn-primary-modern">Guardar Cliente</button>
                </div>
            </form>
        </div>
    </div>
    <div id="modalTarea" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 dark:bg-opacity-80 dark:bg-black overflow-y-auto h-full w-full items-center justify-center z-50 p-4">
        <div class="modal-content w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto p-6 md:p-8">
            <div class="flex justify-between items-center mb-6"><h3 id="modalTareaTitle" class="text-2xl font-semibold">Añadir Nueva Tarea</h3><button id="btnCerrarModalTarea" class="text-brand-text-secondary hover:text-brand-primary text-4xl leading-none btn">&times;</button></div>
            <form id="formTarea">
                <div class="mb-4"><label for="nombreTarea" class="block text-sm font-medium mb-1">Nombre de la Tarea<span class="text-danger">*</span></label><input type="text" id="nombreTarea" required></div>
                <div class="mb-4"><label for="clienteAsociadoTarea" class="block text-sm font-medium mb-1">Cliente Asociado</label><select id="clienteAsociadoTarea"><option value="">Ninguno</option></select></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-4"><div><label for="fechaEntregaTarea">Fecha de Entrega</label><input type="date" id="fechaEntregaTarea"></div><div><label for="estadoTarea">Estado</label><select id="estadoTarea"><option value="Pendiente">Pendiente</option><option value="En Progreso">En Progreso</option><option value="Completada">Completada</option></select></div></div>
                <div class="mb-6"><label for="descripcionTarea">Descripción (Opcional)</label><textarea id="descripcionTarea" rows="3"></textarea></div>
                <div class="mt-8 flex justify-end space-x-3"><button type="button" id="btnCancelarModalTarea" class="btn btn-secondary-modern">Cancelar</button><button type="submit" class="btn btn-primary-modern">Guardar Tarea</button></div>
            </form>
        </div>
    </div>
    <div id="modalPublicacion" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 dark:bg-opacity-80 dark:bg-black overflow-y-auto h-full w-full items-center justify-center z-50 p-4">
        <div class="modal-content w-full max-w-2xl mx-auto max-h-[95vh] overflow-y-auto p-6 md:p-8">
            <div class="flex justify-between items-center mb-6"><h3 id="modalPublicacionTitle" class="text-2xl font-semibold">Añadir Nueva Publicación</h3><button id="btnCerrarModalPublicacion" class="text-brand-text-secondary hover:text-brand-primary text-4xl leading-none btn">&times;</button></div>
            <form id="formPublicacion">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-4">
                    <div><label for="clientePublicacion">Cliente<span class="text-danger">*</span></label><select id="clientePublicacion" required><option value="">-- Seleccione Cliente --</option></select></div>
                    <div><label for="redSocialPublicacion">Red Social<span class="text-danger">*</span></label><select id="redSocialPublicacion" required><option value="">-- Seleccione Red --</option><option value="Instagram">Instagram</option><option value="Facebook">Facebook</option><option value="X">X (Twitter)</option><option value="LinkedIn">LinkedIn</option><option value="TikTok">TikTok</option><option value="Blog">Blog</option><option value="Otra">Otra</option></select></div>
                    <div><label for="fechaPublicacion">Fecha Publicación<span class="text-danger">*</span></label><input type="date" id="fechaPublicacion" required></div>
                    <div><label for="horaPublicacion">Hora Publicación</label><input type="time" id="horaPublicacion"></div>
                    <div><label for="tipoContenidoPublicacion">Tipo de Contenido</label><input type="text" id="tipoContenidoPublicacion" placeholder="Ej: Post, Reel, Story"></div>
                    <div><label for="estadoPublicacion">Estado<span class="text-danger">*</span></label><select id="estadoPublicacion" required><option value="Borrador">Borrador</option><option value="Programada">Programada</option><option value="Revisión Cliente">Revisión Cliente</option><option value="Aprobada">Aprobada</option><option value="Publicada">Publicada</option><option value="Rechazada">Rechazada</option></select></div>
                </div>
                <div class="mb-4"><label for="contenidoTextoPublicacion">Contenido / Copy<span class="text-danger">*</span></label><textarea id="contenidoTextoPublicacion" rows="5" required placeholder="Escribe el contenido..."></textarea></div>
                <div class="mb-4"><label for="enlaceMediaPublicacion">Enlace a Media</label><input type="url" id="enlaceMediaPublicacion" placeholder="https://..."></div>
                <div class="mb-6"><label for="notasInternasPublicacion">Notas Internas</label><textarea id="notasInternasPublicacion" rows="3" placeholder="Comentarios..."></textarea></div>
                <div class="mt-8 flex justify-end space-x-3"><button type="button" id="btnCancelarModalPublicacion" class="btn btn-secondary-modern">Cancelar</button><button type="submit" class="btn btn-primary-modern">Guardar Publicación</button></div>
            </form>
        </div>
    </div>
    <div id="modalPaqueteServicio" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 dark:bg-opacity-80 dark:bg-black overflow-y-auto h-full w-full items-center justify-center z-50 p-4">
        <div class="modal-content w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto p-6 md:p-8">
            <div class="flex justify-between items-center mb-6"><h3 id="modalPaqueteServicioTitle" class="text-2xl font-semibold">Añadir Nuevo Paquete</h3><button id="btnCerrarModalPaqueteServicio" class="text-brand-text-secondary hover:text-brand-primary text-4xl leading-none btn">&times;</button></div>
            <form id="formPaqueteServicio">
                <div class="mb-4"><label for="nombrePaquete">Nombre del Paquete<span class="text-danger">*</span></label><input type="text" id="nombrePaquete" required></div>
                <div class="mb-4"><label for="categoriaPaquete">Categoría</label><input type="text" id="categoriaPaquete" placeholder="Ej: Redes Sociales, SEO"></div>
                <div class="mb-4"><label for="descripcionPaquete">Descripción</label><textarea id="descripcionPaquete" rows="4" class="mt-1 block w-full"></textarea></div>
                <div class="mb-4"><label for="precioSugeridoPaquete">Precio Sugerido (Opcional)</label><input type="number" id="precioSugeridoPaquete" step="0.01" placeholder="0.00"></div>
                <div class="mt-8 flex justify-end space-x-3"><button type="button" id="btnCancelarModalPaqueteServicio" class="btn btn-secondary-modern">Cancelar</button><button type="submit" class="btn btn-primary-modern">Guardar Paquete</button></div>
            </form>
        </div>
    </div>
    <div id="modalIngreso" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 dark:bg-opacity-80 dark:bg-black overflow-y-auto h-full w-full items-center justify-center z-50 p-4">
        <div class="modal-content w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto p-6 md:p-8">
            <div class="flex justify-between items-center mb-6"><h3 id="modalIngresoTitle" class="text-2xl font-semibold">Registrar Nuevo Ingreso</h3><button id="btnCerrarModalIngreso" class="text-brand-text-secondary hover:text-brand-primary text-4xl leading-none btn">&times;</button></div>
            <form id="formIngreso">
                <div class="mb-4"><label for="clienteIngreso">Cliente<span class="text-danger">*</span></label><select id="clienteIngreso" required><option value="">-- Seleccione Cliente --</option></select></div>
                <div class="mb-4"><label for="fechaPagoIngreso">Fecha de Pago<span class="text-danger">*</span></label><input type="date" id="fechaPagoIngreso" required></div>
                <div class="mb-4"><label for="montoIngreso">Monto<span class="text-danger">*</span></label><input type="number" id="montoIngreso" step="0.01" required placeholder="0.00"></div>
                <div class="mb-4"><label for="conceptoIngreso">Concepto<span class="text-danger">*</span></label><input type="text" id="conceptoIngreso" required placeholder="Ej: Paquete Redes Enero"></div>
                <div class="mb-4"><label for="metodoPagoIngreso">Método de Pago</label><select id="metodoPagoIngreso"><option value="">-- Método --</option><option value="Transferencia">Transferencia</option><option value="Efectivo">Efectivo</option><option value="PayPal">PayPal</option><option value="Stripe">Stripe</option><option value="MercadoPago">MercadoPago</option><option value="Otro">Otro</option></select></div>
                <div class="mb-4"><label for="referenciaPaqueteIngreso">Paquete Asociado (Opcional)</label><select id="referenciaPaqueteIngreso"><option value="">-- Ninguno --</option></select></div>
                <div class="mb-6"><label for="notasIngreso">Notas Adicionales</label><textarea id="notasIngreso" rows="3"></textarea></div>
                <div class="mt-8 flex justify-end space-x-3"><button type="button" id="btnCancelarModalIngreso" class="btn btn-secondary-modern">Cancelar</button><button type="submit" class="btn btn-primary-modern">Guardar Ingreso</button></div>
            </form>
        </div>
    </div>
    <div id="modalCuentaCobrar" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 dark:bg-opacity-80 dark:bg-black overflow-y-auto h-full w-full items-center justify-center z-50 p-4">
        <div class="modal-content w-full max-w-xl mx-auto max-h-[95vh] overflow-y-auto p-6 md:p-8">
            <div class="flex justify-between items-center mb-6"><h3 id="modalCuentaCobrarTitle" class="text-2xl font-semibold">Añadir Nueva Cuenta por Cobrar</h3><button id="btnCerrarModalCuentaCobrar" class="text-brand-text-secondary hover:text-brand-primary text-4xl leading-none btn">&times;</button></div>
            <form id="formCuentaCobrar">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-4">
                    <div><label for="clienteCuentaCobrar">Cliente<span class="text-danger">*</span></label><select id="clienteCuentaCobrar" required><option value="">-- Seleccione Cliente --</option></select></div>
                    <div><label for="conceptoCuentaCobrar">Concepto<span class="text-danger">*</span></label><input type="text" id="conceptoCuentaCobrar" required placeholder="Ej: Factura #123"></div>
                    <div><label for="montoCuentaCobrar">Monto Total<span class="text-danger">*</span></label><input type="number" id="montoCuentaCobrar" step="0.01" required placeholder="0.00"></div>
                    <div><label for="montoPagadoCuentaCobrar">Monto Pagado Inicialmente</label><input type="number" id="montoPagadoCuentaCobrar" step="0.01" placeholder="0.00" value="0"></div>
                    <div><label for="fechaEmisionCuentaCobrar">Fecha de Emisión<span class="text-danger">*</span></label><input type="date" id="fechaEmisionCuentaCobrar" required></div>
                    <div><label for="fechaVencimientoCuentaCobrar">Fecha de Vencimiento</label><input type="date" id="fechaVencimientoCuentaCobrar"></div>
                    <div><label for="estadoCuentaCobrar">Estado<span class="text-danger">*</span></label><select id="estadoCuentaCobrar" required><option value="Pendiente">Pendiente</option><option value="Pagada Parcialmente">Pagada Parcialmente</option><option value="Pagada">Pagada</option><option value="Vencida">Vencida</option><option value="Cancelada">Cancelada</option></select></div>
                    <div><label for="fechaUltimoPagoCuentaCobrar">Fecha Último Pago</label><input type="date" id="fechaUltimoPagoCuentaCobrar"></div>
                </div>
                <div class="mb-6"><label for="notasCuentaCobrar">Notas</label><textarea id="notasCuentaCobrar" rows="3"></textarea></div>
                <div class="mt-8 flex justify-end space-x-3"><button type="button" id="btnCancelarModalCuentaCobrar" class="btn btn-secondary-modern">Cancelar</button><button type="submit" class="btn btn-primary-modern">Guardar Cuenta</button></div>
            </form>
        </div>
    </div>
    <div id="modalCuentaEmpresa" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 dark:bg-opacity-80 dark:bg-black overflow-y-auto h-full w-full items-center justify-center z-50 p-4">
        <div class="modal-content w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto p-6 md:p-8">
            <div class="flex justify-between items-center mb-6"><h3 id="modalCuentaEmpresaTitle" class="text-2xl font-semibold">Añadir Cuenta de Empresa</h3><button id="btnCerrarModalCuentaEmpresa" class="text-brand-text-secondary hover:text-brand-primary text-4xl leading-none btn">&times;</button></div>
            <form id="formCuentaEmpresa">
                <div class="mb-4"><label for="nombreEntidadCuentaEmpresa">Nombre Entidad (Banco, Plataforma)<span class="text-danger">*</span></label><input type="text" id="nombreEntidadCuentaEmpresa" required></div>
                <div class="mb-4"><label for="tipoCuentaEmpresa">Tipo de Cuenta<span class="text-danger">*</span></label><input type="text" id="tipoCuentaEmpresa" placeholder="Ej: Corriente, PayPal, Caja Chica" required></div>
                <div class="mb-4"><label for="identificadorCuentaEmpresa">Identificador (Nº Cuenta, Email, etc.)<span class="text-danger">*</span></label><input type="text" id="identificadorCuentaEmpresa" required></div>
                <div class="mb-4"><label for="titularCuentaEmpresa">Titular</label><input type="text" id="titularCuentaEmpresa"></div>
                <div class="mb-4"><label for="monedaCuentaEmpresa">Moneda</label><input type="text" id="monedaCuentaEmpresa" placeholder="Ej: USD, EUR, MXN"></div>
                <div class="mb-6"><label for="notasConfidencialesCuentaEmpresa">Notas Confidenciales</label><textarea id="notasConfidencialesCuentaEmpresa" rows="3" placeholder="Información sensible, solo para tu referencia."></textarea></div>
                <div class="mt-8 flex justify-end space-x-3"><button type="button" id="btnCancelarModalCuentaEmpresa" class="btn btn-secondary-modern">Cancelar</button><button type="submit" class="btn btn-primary-modern">Guardar Cuenta</button></div>
            </form>
        </div>
    </div>
    <div id="modalConfirmacion" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 dark:bg-opacity-80 dark:bg-black items-center justify-center z-[60] p-4">
        <div class="modal-content w-full max-w-md mx-auto p-6 md:p-8 text-center">
            <h3 id="modalConfirmacionTitle" class="text-xl font-semibold text-brand-text-primary mb-3">Confirmar Acción</h3>
            <p id="modalConfirmacionMessage" class="text-brand-text-secondary mb-6">¿Estás seguro?</p>
            <div class="flex justify-center space-x-4"><button id="btnConfirmarModalAccion" class="btn btn-primary-modern bg-danger hover:bg-red-700">Confirmar</button><button id="btnCancelarModalConfirmacion" class="btn btn-secondary-modern">Cancelar</button></div>
        </div>
    </div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanilla-js-calendar@1.6.1/build/vanilla-js-calendar.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Theme toggle elements
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
            const themeToggleTextEl = document.getElementById('theme-toggle-text'); 

            // Sidebar toggle elements
            const sidebarEl = document.querySelector('aside'); 
            const mainContentForSidebar = document.querySelector('main'); 
            const sidebarToggleBtnEl = document.getElementById('sidebar-toggle'); 


            const navLinks = document.querySelectorAll('nav .nav-link'); // CORREGIDO
            const pageSections = document.querySelectorAll('.page-section');
            const btnAbrirModalCliente = document.getElementById('btnAbrirModalCliente');
            const modalCliente = document.getElementById('modalCliente');
            const modalClienteContent = modalCliente.querySelector('.modal-content');
            const btnCerrarModalCliente = document.getElementById('btnCerrarModalCliente');
            const btnCancelarModalCliente = document.getElementById('btnCancelarModalCliente');
            const formCliente = document.getElementById('formCliente');
            const modalClienteTitle = document.getElementById('modalClienteTitle');
            const serviciosContratadosContainer = document.getElementById('serviciosContratadosContainer');
            const selectPaqueteServicio = document.getElementById('selectPaqueteServicio');
            const montoPaqueteServicioInput = document.getElementById('montoPaqueteServicio');
            const tipoCobroPaqueteServicioSelect = document.getElementById('tipoCobroPaqueteServicio');
            const btnAddServicioContratado = document.getElementById('btnAddServicioContratado');
            
            // NUEVOS IDs para Credenciales Redes
            const credencialesRedesContainer = document.getElementById('credencialesRedesContainer');
            const nuevaRedSocialNombreInput = document.getElementById('nuevaRedSocialNombre');
            const nuevaRedSocialUsuarioInput = document.getElementById('nuevaRedSocialUsuario');
            const nuevaRedSocialPasswordInput = document.getElementById('nuevaRedSocialPassword');
            const btnAddCredencialRed = document.getElementById('btnAddCredencialRed');

            const btnAbrirModalTarea = document.getElementById('btnAbrirModalTarea');
            const modalTarea = document.getElementById('modalTarea');
            const modalTareaContent = modalTarea.querySelector('.modal-content');
            const btnCerrarModalTarea = document.getElementById('btnCerrarModalTarea');
            const btnCancelarModalTarea = document.getElementById('btnCancelarModalTarea');
            const formTarea = document.getElementById('formTarea');
            const modalTareaTitle = document.getElementById('modalTareaTitle');
            const clienteAsociadoTareaSelect = document.getElementById('clienteAsociadoTarea');
            const tablaClientesBody = document.getElementById('tablaClientesBody');
            const tablaServiciosWebBody = document.getElementById('tablaServiciosWebBody');
            const tablaTareasBody = document.getElementById('tablaTareasBody');
            const listaPaquetesServiciosEl = document.getElementById('listaPaquetesServicios');
            const totalClientesActivosEl = document.getElementById('totalClientesActivos');
            const totalClientesRevisarEl = document.getElementById('totalClientesRevisar');
            const totalServiciosWebEl = document.getElementById('totalServiciosWeb');
            const totalTareasPendientesEl = document.getElementById('totalTareasPendientes');
            const listaPerfilesClientesEl = document.getElementById('listaPerfilesClientes');
            const detallePerfilClientePreviewEl = document.getElementById('detallePerfilClientePreview');
            const perfilDedicadoSection = document.getElementById('perfil-cliente-dedicado');
            const nombrePerfilDedicadoEl = document.getElementById('nombrePerfilDedicado');
            const btnVolverDesdePerfil = document.getElementById('btnVolverDesdePerfil');
            const btnEditarDesdePerfil = document.getElementById('btnEditarDesdePerfil');
            const perfilDedicadoClinicaEl = document.getElementById('perfilDedicadoClinica');
            const perfilDedicadoEmailEl = document.getElementById('perfilDedicadoEmail');
            const perfilDedicadoTelefonoEl = document.getElementById('perfilDedicadoTelefono');
            const perfilDedicadoPagadoEl = document.getElementById('perfilDedicadoPagado');
            const perfilDedicadoNotasEl = document.getElementById('perfilDedicadoNotas');
            const perfilDedicadoServiciosContratadosUl = document.getElementById('perfilDedicadoServiciosContratados');
            const perfilDedicadoDominioWebEl = document.getElementById('perfilDedicadoDominioWeb');
            const perfilDedicadoTipoWebEl = document.getElementById('perfilDedicadoTipoWeb');
            const perfilDedicadoVencimientoWebEl = document.getElementById('perfilDedicadoVencimientoWeb');
            const perfilDedicadoConfigRedesDiv = document.getElementById('perfilDedicadoConfigRedes');
            const perfilDedicadoCredencialesResumenUl = document.querySelector('#perfilDedicadoCredencialesResumen ul'); // Para mostrar resumen
            const perfilDedicadoTareasUl = document.getElementById('perfilDedicadoTareas');
            const btnExportarCSVClientes = document.getElementById('btnExportarCSVClientes');
            const buscadorClientesInput = document.getElementById('buscadorClientes');
            const calendarContainer = document.getElementById('calendar-container');
            let calendarInstance = null;
            const listaTareasUrgentesDashboardEl = document.getElementById('listaTareasUrgentesDashboard');
            const listaServiciosPorVencerDashboardEl = document.getElementById('listaServiciosPorVencerDashboard');
            const tablaPublicacionesBody = document.getElementById('tablaPublicacionesBody');
            const btnAbrirModalPublicacion = document.getElementById('btnAbrirModalPublicacion');
            const modalPublicacion = document.getElementById('modalPublicacion');
            const modalPublicacionContent = modalPublicacion.querySelector('.modal-content');
            const btnCerrarModalPublicacion = document.getElementById('btnCerrarModalPublicacion');
            const btnCancelarModalPublicacion = document.getElementById('btnCancelarModalPublicacion');
            const formPublicacion = document.getElementById('formPublicacion');
            const modalPublicacionTitle = document.getElementById('modalPublicacionTitle');
            const clientePublicacionSelect = document.getElementById('clientePublicacion');
            const filtroPublicacionesClienteSelect = document.getElementById('filtroPublicacionesCliente');
            const filtroPublicacionesEstadoSelect = document.getElementById('filtroPublicacionesEstado');
            const btnAbrirModalPaqueteServicio = document.getElementById('btnAbrirModalPaqueteServicio');
            const modalPaqueteServicio = document.getElementById('modalPaqueteServicio');
            const modalPaqueteServicioContent = modalPaqueteServicio.querySelector('.modal-content');
            const btnCerrarModalPaqueteServicio = document.getElementById('btnCerrarModalPaqueteServicio');
            const btnCancelarModalPaqueteServicio = document.getElementById('btnCancelarModalPaqueteServicio');
            const formPaqueteServicio = document.getElementById('formPaqueteServicio');
            const modalConfirmacion = document.getElementById('modalConfirmacion');
            const modalConfirmacionContent = modalConfirmacion.querySelector('.modal-content');
            const modalConfirmacionTitleEl = document.getElementById('modalConfirmacionTitle');
            const modalConfirmacionMessageEl = document.getElementById('modalConfirmacionMessage');
            const btnConfirmarModalAccion = document.getElementById('btnConfirmarModalAccion');
            const btnCancelarModalConfirmacion = document.getElementById('btnCancelarModalConfirmacion');
            let confirmacionCallback = null;
            const btnVerCalendarioCompleto = document.getElementById('btnVerCalendarioCompleto');
            const listaProximasTareasDashboardEl = document.getElementById('listaProximasTareasDashboard');
            const tablaIngresosBody = document.getElementById('tablaIngresosBody');
            const btnAbrirModalIngreso = document.getElementById('btnAbrirModalIngreso');
            const modalIngreso = document.getElementById('modalIngreso');
            const modalIngresoContent = modalIngreso.querySelector('.modal-content');
            const btnCerrarModalIngreso = document.getElementById('btnCerrarModalIngreso');
            const btnCancelarModalIngreso = document.getElementById('btnCancelarModalIngreso');
            const formIngreso = document.getElementById('formIngreso');
            const clienteIngresoSelect = document.getElementById('clienteIngreso');
            const referenciaPaqueteIngresoSelect = document.getElementById('referenciaPaqueteIngreso');
            const filtroIngresosClienteSelect = document.getElementById('filtroIngresosCliente');
            const filtroIngresosMesInput = document.getElementById('filtroIngresosMes');
            const totalIngresosVisualizadosEl = document.getElementById('totalIngresosVisualizados');
            const tablaCuentasCobrarBody = document.getElementById('tablaCuentasCobrarBody');
            const btnAbrirModalCuentaCobrar = document.getElementById('btnAbrirModalCuentaCobrar');
            const modalCuentaCobrar = document.getElementById('modalCuentaCobrar');
            const modalCuentaCobrarContent = modalCuentaCobrar.querySelector('.modal-content');
            const btnCerrarModalCuentaCobrar = document.getElementById('btnCerrarModalCuentaCobrar');
            const btnCancelarModalCuentaCobrar = document.getElementById('btnCancelarModalCuentaCobrar');
            const formCuentaCobrar = document.getElementById('formCuentaCobrar');
            const clienteCuentaCobrarSelect = document.getElementById('clienteCuentaCobrar');
            const filtroCuentasCobrarClienteSelect = document.getElementById('filtroCuentasCobrarCliente');
            const filtroCuentasCobrarEstadoSelect = document.getElementById('filtroCuentasCobrarEstado');
            const totalSaldoPendienteVisualizadoEl = document.getElementById('totalSaldoPendienteVisualizado');
            const paginacionPublicacionesContainer = document.getElementById('paginacionPublicacionesContainer');
            const btnPrevPublicaciones = document.getElementById('btnPrevPublicaciones');
            const numerosPaginaPublicacionesEl = document.getElementById('numerosPaginaPublicaciones');
            const btnNextPublicaciones = document.getElementById('btnNextPublicaciones');
            const tablaCuentasEmpresaBody = document.getElementById('tablaCuentasEmpresaBody');
            const btnAbrirModalCuentaEmpresa = document.getElementById('btnAbrirModalCuentaEmpresa');
            const modalCuentaEmpresa = document.getElementById('modalCuentaEmpresa');
            const modalCuentaEmpresaContent = modalCuentaEmpresa.querySelector('.modal-content');
            const btnCerrarModalCuentaEmpresa = document.getElementById('btnCerrarModalCuentaEmpresa');
            const btnCancelarModalCuentaEmpresa = document.getElementById('btnCancelarModalCuentaEmpresa');
            const formCuentaEmpresa = document.getElementById('formCuentaEmpresa');

            const loginScreen = document.getElementById('loginScreen');
            const loginForm = document.getElementById('loginForm');
            const loginErrorEl = document.getElementById('loginError');
            const mainContentWrapper = document.querySelector('.content-wrapper'); 
            const btnLogout = document.getElementById('btnLogout');
            const SESSION_TOKEN_KEY = 'mediClicksSessionToken';


            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbywJcsdl7E49GPGyE76LBTklLGbf0ijVmuCpo9Hd99oaW_X_KpOXjVwcEitG6qRQ14l/exec"; // !!! REEMPLAZA ESTO !!!
            const GOOGLE_CALENDAR_ID_FOR_VIEW = "50ba71bc988d110add8e3ca4fea84000056fb4c8f49d02a5f4734d2cf261716f@group.calendar.google.com";

            // ... (resto de tu JS de inicialización, applyTheme, etc.) ...
            // ... (incluye las funciones saveDataToSheets y fetchInitialData como las tenías) ...

            // VARIABLES GLOBALES (ya existentes, añadir la nueva)
            let clientes_data = []; let tareas_data = []; let publicaciones_data = []; let paquetes_servicios_data = []; let ingresos_data = []; let cuentas_cobrar_data = []; let cuentas_empresa_data = [];
            let editandoClienteIndex = null; 
            let tempServiciosContratados = []; 
            let tempCredencialesRedes = []; // NUEVO ARRAY PARA CREDENCIALES
            let editandoTareaIndex = null; 
            let editandoPublicacionId = null; 
            let editandoPaqueteId = null; // NUEVO para editar paquetes
            let editandoCuentaCobrarId = null; 
            let editandoCuentaEmpresaId = null;
            let clienteSeleccionadoPerfilDedicadoId = null; 
            let vistaAnterior = '#dashboard';
            let currentPagePublicaciones = 1; const itemsPerPagePublicaciones = 7;

            // PEGA AQUÍ LAS FUNCIONES:
            // - applyTheme
            // - showToast
            // - saveDataToSheets
            // - fetchInitialData
            // - Todas las funciones guardarXEnSheets y eliminarXDeSheets
            // - formatLocalDate
            // - showLoadingIndicator
            // - updateDashboardCounters, renderizarListaPerfilesDashboard, etc. (componentes del dashboard)
            // - inicializarCalendario, actualizarCalendario
            // - showSection
            // - handleVerPerfilDedicado, mostrarPerfilDedicado
            // - Todas las funciones renderizarX, poblarSelectorX, abrirModalX, cerrarModalX, formX.addEventListener, handleEditarX, handleEliminarX
            //   (para clientes, tareas, publicaciones, paquetes, ingresos, cuentas por cobrar, cuentas empresa)
            // - mostrarModalConfirmacion, cerrarModalConfirmacion, y sus listeners
            // - btnVerCalendarioCompleto listener
            // - buscadorClientesInput listener
            // - exportToCSV
            // - navLinks.forEach y window.addEventListener('hashchange')
            // - listeners para btnAbrirModalCliente, etc. (si no están ya dentro de las funciones de arriba)
            // - FUNCIONES DE LOGIN/LOGOUT (showLoginScreen, showAppScreen, clearSessionAndShowLogin, checkLoginState, listeners de loginForm y btnLogout)


            // --------- INICIO SECCIÓN MODIFICADA/NUEVA PARA CLIENTES Y PAQUETES ---------
            function renderizarCredencialesRedesEnModal(credenciales) {
                if (!credencialesRedesContainer) return;
                const advertenciaDiv = credencialesRedesContainer.querySelector('.italic.p-3'); // Más específico
                credencialesRedesContainer.innerHTML = ''; 
                if (advertenciaDiv) credencialesRedesContainer.appendChild(advertenciaDiv); 

                if (!credenciales || !Array.isArray(credenciales) || credenciales.length === 0) {
                    const p = document.createElement('p');
                    p.className = 'text-sm text-brand-text-secondary dark:text-slate-400 pl-3'; // Añadido padding
                    p.textContent = 'No hay credenciales añadidas.';
                    credencialesRedesContainer.appendChild(p);
                    return;
                }
                credenciales.forEach((cred, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-3 bg-brand-light-bg dark:bg-slate-700 rounded-md shadow-sm';
                    div.innerHTML = `
                        <div>
                            <p class="font-medium text-sm text-brand-primary dark:text-primary-light">${cred.redSocial}</p>
                            <p class="text-xs text-brand-text-secondary dark:text-slate-400">Usuario: ${cred.usuario}</p>
                            <p class="text-xs text-brand-text-secondary dark:text-slate-400">Contraseña: ****** </p> 
                        </div>
                        <button type="button" data-index="${index}" class="text-danger dark:text-danger-light hover:text-red-700 dark:hover:text-red-300 font-semibold text-sm btnRemoveCredencialRed">&times; Quitar</button>
                    `;
                    credencialesRedesContainer.appendChild(div);
                });

                document.querySelectorAll('.btnRemoveCredencialRed').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const credIndex = parseInt(e.target.dataset.index);
                        tempCredencialesRedes.splice(credIndex, 1);
                        renderizarCredencialesRedesEnModal(tempCredencialesRedes);
                    });
                });
            }

            if (btnAddCredencialRed) {
                btnAddCredencialRed.addEventListener('click', () => {
                    const redSocial = nuevaRedSocialNombreInput.value.trim();
                    const usuario = nuevaRedSocialUsuarioInput.value.trim();
                    const password = nuevaRedSocialPasswordInput.value; 

                    if (!redSocial || !usuario || !password) {
                        showToast('Todos los campos de credencial son obligatorios.', "warning");
                        return;
                    }
                    if (tempCredencialesRedes.find(c => c.redSocial.toLowerCase() === redSocial.toLowerCase())) {
                        showToast(`Ya existen credenciales para ${redSocial}. Puede editarlas o eliminarlas primero.`, "info");
                        return;
                    }

                    tempCredencialesRedes.push({ redSocial, usuario, password });
                    renderizarCredencialesRedesEnModal(tempCredencialesRedes);
                    nuevaRedSocialNombreInput.value = '';
                    nuevaRedSocialUsuarioInput.value = '';
                    nuevaRedSocialPasswordInput.value = '';
                    nuevaRedSocialNombreInput.focus();
                });
            }
            
            // Modificar abrirModalCliente
            function abrirModalCliente(esEdicion = false, index = null) {
                formCliente.reset();
                editandoClienteIndex = null;
                tempServiciosContratados = [];
                tempCredencialesRedes = []; 
                poblarSelectPaquetesServicio();

                if (esEdicion && index !== null && clientes_data[index]) {
                    modalClienteTitle.textContent = 'Editar Cliente';
                    const c = clientes_data[index];
                    document.getElementById('nombreCliente').value = c.nombre;
                    document.getElementById('clinicaCliente').value = c.clinica||'';
                    document.getElementById('emailCliente').value = c.email||'';
                    document.getElementById('telefonoCliente').value = c.telefono||'';
                    document.getElementById('serviciosActivosGeneralCliente').value = c.serviciosActivosGeneral||'';
                    document.getElementById('pagadoCliente').value = c.pagado||0;
                    document.getElementById('notasCliente').value = c.notas||'';
                    document.getElementById('dominioWebCliente').value = c.dominioWeb||'';
                    document.getElementById('tipoServicioWebCliente').value = c.tipoServicioWeb||'';
                    document.getElementById('vencimientoWebCliente').value = c.vencimientoWeb||'';
                    document.getElementById('plataformasRedesCliente').value = c.plataformasRedes||''; 
                    document.getElementById('detallesRedesCliente').value = c.detallesRedes||''; 

                    tempServiciosContratados = (Array.isArray(c.serviciosContratados) ? JSON.parse(JSON.stringify(c.serviciosContratados)) : []);
                    tempCredencialesRedes = (Array.isArray(c.credencialesRedes) ? JSON.parse(JSON.stringify(c.credencialesRedes)) : []); 
                    editandoClienteIndex = index;
                } else {
                    modalClienteTitle.textContent = 'Añadir Cliente';
                    tempServiciosContratados = [];
                    tempCredencialesRedes = []; 
                    editandoClienteIndex = null;
                }
                renderizarServiciosContratadosEnModal(tempServiciosContratados);
                renderizarCredencialesRedesEnModal(tempCredencialesRedes); 
                modalCliente.classList.add('active');
                void modalCliente.offsetWidth; 
                modalClienteContent.style.transform = 'translateY(0)';
                document.getElementById('nombreCliente').focus();
            }

            // Modificar cerrarModalCliente
            function cerrarModalCliente() {
                modalClienteContent.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    modalCliente.classList.remove('active');
                    formCliente.reset();
                    editandoClienteIndex = null;
                    tempServiciosContratados = [];
                    tempCredencialesRedes = []; 
                    if(credencialesRedesContainer) { // Limpiar credenciales visualmente
                         const advertenciaDiv = credencialesRedesContainer.querySelector('.italic.p-3');
                         credencialesRedesContainer.innerHTML = '';
                         if(advertenciaDiv) credencialesRedesContainer.appendChild(advertenciaDiv);
                         const p = document.createElement('p');
                         p.className = 'text-sm text-brand-text-secondary dark:text-slate-400 pl-3';
                         p.textContent = 'No hay credenciales añadidas.';
                         credencialesRedesContainer.appendChild(p);
                    }
                    if(serviciosContratadosContainer) serviciosContratadosContainer.innerHTML = '<p class="text-sm text-brand-text-secondary dark:text-slate-400">No hay paquetes.</p>';


                }, 300);
            }
            
            // Modificar submit de formCliente
            formCliente.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitButton = e.submitter;
                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = `<span class="spinner-inline" role="status" aria-hidden="true"></span>Guardando...`;
                try {
                    const idC = (editandoClienteIndex !== null && clientes_data[editandoClienteIndex]) ? clientes_data[editandoClienteIndex].id : 'cliente_' + Date.now();
                    let dC = {
                        id: idC,
                        nombre: document.getElementById('nombreCliente').value.trim(),
                        clinica: document.getElementById('clinicaCliente').value.trim(),
                        email: document.getElementById('emailCliente').value.trim(),
                        telefono: document.getElementById('telefonoCliente').value.trim(),
                        serviciosActivosGeneral: document.getElementById('serviciosActivosGeneralCliente').value.trim(),
                        pagado: parseFloat(document.getElementById('pagadoCliente').value) || 0,
                        notas: document.getElementById('notasCliente').value.trim(),
                        dominioWeb: document.getElementById('dominioWebCliente').value.trim(),
                        tipoServicioWeb: document.getElementById('tipoServicioWebCliente').value.trim(),
                        vencimientoWeb: document.getElementById('vencimientoWebCliente').value,
                        plataformasRedes: document.getElementById('plataformasRedesCliente').value.trim(),
                        detallesRedes: document.getElementById('detallesRedesCliente').value.trim(),
                        serviciosContratados: [...tempServiciosContratados],
                        credencialesRedes: [...tempCredencialesRedes] 
                    };
                    dC.configuracionRedes = (editandoClienteIndex !== null && clientes_data[editandoClienteIndex] && clientes_data[editandoClienteIndex].configuracionRedes) ? clientes_data[editandoClienteIndex].configuracionRedes : {};
                    if (dC.nombre === "") {
                        showToast("Nombre cliente obligatorio.", "warning");
                        document.getElementById('nombreCliente').focus();
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                        return;
                    }
                    const guardadoOK = await guardarClienteEnSheets(dC);
                    if (guardadoOK) {
                        showToast(editandoClienteIndex !== null ? "Cliente actualizado" : "Cliente añadido", "success");
                        renderizarClientesResumen();
                        cerrarModalCliente();
                        poblarSelectorClientesTarea();
                        poblarSelectoresClientePublicaciones();
                        poblarSelectorClienteIngresos();
                        poblarSelectorClienteCuentasCobrar();
                        if (!perfilDedicadoSection.classList.contains('hidden') && clienteSeleccionadoPerfilDedicadoId === dC.id) {
                            mostrarPerfilDedicado(dC.id);
                        }
                    }
                } catch (error) {
                    console.error("Error en submit formCliente:", error);
                    showToast("Ocurrió un error al guardar.", "error");
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                }
            });

            // Modificar mostrarPerfilDedicado para incluir resumen de credenciales (solo nombres)
            function mostrarPerfilDedicado(clienteId) {
                const cliente = clientes_data.find(c => c.id === clienteId);
                if (!cliente) { showToast("Cliente no encontrado.", "error"); window.location.hash = '#clientes'; return; }
                nombrePerfilDedicadoEl.textContent = cliente.nombre;
                perfilDedicadoClinicaEl.textContent = cliente.clinica || '-';
                perfilDedicadoEmailEl.textContent = cliente.email || '-';
                perfilDedicadoTelefonoEl.textContent = cliente.telefono || '-';
                perfilDedicadoPagadoEl.textContent = `$${(parseFloat(cliente.pagado) || 0).toFixed(2)}`;
                perfilDedicadoNotasEl.textContent = cliente.notas || '-';
                perfilDedicadoServiciosContratadosUl.innerHTML = '';
                if (cliente.serviciosContratados && Array.isArray(cliente.serviciosContratados) && cliente.serviciosContratados.length > 0) {
                    cliente.serviciosContratados.forEach(s => {
                        const li = document.createElement('li');
                        li.innerHTML = `<strong>${s.nombreServicio}</strong> (Cobro: ${s.tipoCobro} - $${s.monto})`;
                        perfilDedicadoServiciosContratadosUl.appendChild(li);
                    });
                } else {
                    perfilDedicadoServiciosContratadosUl.innerHTML = '<li>No hay paquetes contratados.</li>';
                }
                perfilDedicadoDominioWebEl.textContent = cliente.dominioWeb || '-';
                perfilDedicadoTipoWebEl.textContent = cliente.tipoServicioWeb || '-';
                perfilDedicadoVencimientoWebEl.textContent = formatLocalDate(cliente.vencimientoWeb);
                
                perfilDedicadoConfigRedesDiv.innerHTML = '';
                let confRedesHTML = ''; 
                if (cliente.plataformasRedes || cliente.detallesRedes) {
                    confRedesHTML += `<p><strong>Plataformas:</strong> ${cliente.plataformasRedes || '-'}</p><p><strong>Detalles/Estrategia:</strong><br><span class="whitespace-pre-wrap">${cliente.detallesRedes || '-'}</span></p>`;
                }
                perfilDedicadoConfigRedesDiv.innerHTML = confRedesHTML || '<p class="text-xs text-brand-text-secondary dark:text-slate-400">Sin info general de redes.</p>';

                if(perfilDedicadoCredencialesResumenUl){
                    perfilDedicadoCredencialesResumenUl.innerHTML = '';
                    if(cliente.credencialesRedes && Array.isArray(cliente.credencialesRedes) && cliente.credencialesRedes.length > 0){
                        cliente.credencialesRedes.forEach(cred => {
                            const li = document.createElement('li');
                            li.textContent = cred.redSocial;
                            perfilDedicadoCredencialesResumenUl.appendChild(li);
                        });
                    } else {
                        const li = document.createElement('li');
                        li.textContent = 'Ninguna';
                        li.className = 'italic';
                        perfilDedicadoCredencialesResumenUl.appendChild(li);
                    }
                }
                
                perfilDedicadoTareasUl.innerHTML = '';
                const tareasCliente = tareas_data.filter(t => String(t.clienteId) === String(clienteId));
                if (tareasCliente.length > 0) {
                    tareasCliente.forEach(t => {
                        const li = document.createElement('li');
                        let eCol = 'text-brand-text-secondary dark:text-slate-400';
                        if(t.estado==='Pendiente')eCol='text-warning dark:text-yellow-400';
                        else if(t.estado==='En Progreso')eCol='text-info dark:text-blue-400';
                        else if(t.estado==='Completada')eCol='text-success dark:text-green-400';
                        li.innerHTML = `<strong>${t.nombre}</strong> - <span class="${eCol} font-semibold">${t.estado}</span> ${t.fechaEntrega ? `(Entrega: ${formatLocalDate(t.fechaEntrega)})` : ''}`;
                        perfilDedicadoTareasUl.appendChild(li);
                    });
                } else {
                    perfilDedicadoTareasUl.innerHTML = '<li>Sin tareas asociadas.</li>';
                }
            }
            
            // Modificar abrirModalPaqueteServicio
            function abrirModalPaqueteServicio(esEdicion = false, paqueteId = null) { // nombre de parámetro cambiado
                formPaqueteServicio.reset();
                editandoPaqueteId = null; // Usar la variable global
                const modalTitle = document.getElementById('modalPaqueteServicioTitle');

                if (esEdicion && paqueteId) {
                    const paquete = paquetes_servicios_data.find(p => p.id === paqueteId);
                    if (paquete) {
                        if(modalTitle) modalTitle.textContent = "Editar Paquete de Servicio";
                        document.getElementById('nombrePaquete').value = paquete.nombre;
                        document.getElementById('categoriaPaquete').value = paquete.categoria || '';
                        document.getElementById('descripcionPaquete').value = paquete.descripcion || '';
                        document.getElementById('precioSugeridoPaquete').value = paquete.precioSugerido || '';
                        editandoPaqueteId = paqueteId; // Establecer el ID para edición
                    } else {
                        showToast("Paquete no encontrado para editar.", "error");
                        return; // Salir si el paquete no se encuentra
                    }
                } else {
                    if(modalTitle) modalTitle.textContent = "Añadir Nuevo Paquete";
                }

                document.getElementById('nombrePaquete').focus();
                modalPaqueteServicio.classList.add('active');
                void modalPaqueteServicio.offsetWidth;
                modalPaqueteServicioContent.style.transform = 'translateY(0)';
            }

            // Modificar submit de formPaqueteServicio
            formPaqueteServicio.addEventListener('submit', async (e) => {
                e.preventDefault();
                const submitButton = e.submitter;
                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = `<span class="spinner-inline" role="status" aria-hidden="true"></span>Guardando...`;
                try {
                    const nombre = document.getElementById('nombrePaquete').value.trim();
                    if (!nombre) {
                        showToast("Nombre del paquete obligatorio.", "warning");
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                        document.getElementById('nombrePaquete').focus();
                        return;
                    }
                    
                    const datosPaquete = {
                        id: editandoPaqueteId, // Se enviará null si es nuevo, o el ID si se edita
                        nombre: nombre,
                        categoria: document.getElementById('categoriaPaquete').value.trim(),
                        descripcion: document.getElementById('descripcionPaquete').value.trim(),
                        precioSugerido: parseFloat(document.getElementById('precioSugeridoPaquete').value) || null
                    };

                    const result = await guardarPaqueteServicioEnSheets(datosPaquete); 
                    if (result && result.success) { // Verificar que result y result.success existan
                        showToast(editandoPaqueteId ? "Paquete actualizado" : "Paquete añadido", "success");
                        const paqueteGuardado = result.data; // El backend debería devolver el objeto completo con ID
                        
                        if (editandoPaqueteId) {
                            const index = paquetes_servicios_data.findIndex(p => p.id === editandoPaqueteId);
                            if (index !== -1) paquetes_servicios_data[index] = paqueteGuardado;
                            else paquetes_servicios_data.push(paqueteGuardado); // Por si acaso no se encontró pero es una actualización
                        } else {
                             paquetes_servicios_data.push(paqueteGuardado); 
                        }
                        renderizarPaquetesServicios();
                        poblarSelectPaquetesServicio(); 
                        cerrarModalPaqueteServicio();
                    } else {
                         showToast(result.error || "Error al guardar el paquete.", "error");
                    }
                } catch (error) {
                    console.error("Error submit formPaqueteServicio:", error);
                    showToast("Ocurrió un error.", "error");
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    editandoPaqueteId = null; // Resetear después de guardar
                }
            });

            // Nuevas funciones handler para paquetes
            function handleEditarPaquete(e) {
                const paqueteId = e.target.dataset.id;
                abrirModalPaqueteServicio(true, paqueteId);
            }

            async function handleEliminarPaquete(e) {
                const paqueteId = e.target.dataset.id;
                const paquete = paquetes_servicios_data.find(p => p.id === paqueteId);
                if (paquete) {
                    mostrarModalConfirmacion(
                        "Confirmar Eliminación",
                        `¿Seguro que quieres eliminar el paquete "${paquete.nombre}"? Esta acción no se puede deshacer.`,
                        async () => {
                            const result = await saveDataToSheets("deletePaqueteServicio", { id: paqueteId });
                            if (result.success) {
                                paquetes_servicios_data = paquetes_servicios_data.filter(p => p.id !== paqueteId);
                                renderizarPaquetesServicios();
                                poblarSelectPaquetesServicio();
                                showToast("Paquete eliminado", "success");
                            } else {
                                showToast("Error al eliminar el paquete.", "error");
                            }
                        },
                        "Eliminar Paquete",
                        "bg-danger hover:bg-red-700"
                    );
                }
            }
             // Renderizar paquetes de servicios (añadir botones)
             function renderizarPaquetesServicios() {
                if (!listaPaquetesServiciosEl) return;
                listaPaquetesServiciosEl.innerHTML = '';
                if (paquetes_servicios_data.length === 0) {
                    listaPaquetesServiciosEl.innerHTML = '<p class="text-brand-text-secondary dark:text-slate-400 col-span-full text-center py-4">No hay paquetes de servicios definidos. Añade el primero.</p>';
                    return;
                }
                paquetes_servicios_data.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'content-card-modern flex flex-col justify-between';
                    card.innerHTML = `
                        <div>
                            <h3 class="text-lg font-semibold text-brand-primary dark:text-primary-light mb-2">${p.nombre}</h3>
                            <p class="text-sm text-brand-text-secondary dark:text-slate-400 mb-1"><strong>Categoría:</strong> ${p.categoria || 'N/A'}</p>
                            <p class="text-sm text-brand-text-secondary dark:text-slate-400 mb-3">${p.descripcion || 'Sin descripción.'}</p>
                            ${p.precioSugerido ? `<p class="text-sm font-medium text-brand-text-primary dark:text-slate-200">Precio Sug.: $${parseFloat(p.precioSugerido).toFixed(2)}</p>` : ''}
                        </div>
                        <div class="mt-4 pt-3 border-t border-brand-border-light dark:border-slate-700 flex justify-end space-x-2">
                            <button data-id="${p.id}" class="btn btn-secondary-modern btn-sm editar-paquete-btn">Editar</button>
                            <button data-id="${p.id}" class="btn btn-sm eliminar-paquete-btn bg-danger/80 hover:bg-danger text-white">Eliminar</button>
                        </div>
                    `; // btn-danger es una clase de Tailwind, si la tienes definida
                    listaPaquetesServiciosEl.appendChild(card);
                });

                document.querySelectorAll('.editar-paquete-btn').forEach(btn => btn.addEventListener('click', handleEditarPaquete));
                document.querySelectorAll('.eliminar-paquete-btn').forEach(btn => btn.addEventListener('click', handleEliminarPaquete));
            }


            // --------- FIN SECCIÓN MODIFICADA/NUEVA ---------


            // AL FINAL DE TODO, DENTRO DEL DOMContentLoaded:
            checkLoginState(); 

        });
    </script>
</body>
</html>
